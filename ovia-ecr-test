pipeline{
    agent any
    tools{
        maven 'Maven'
    }
    environment{
        cred = credentials('aws-access-key')
    }
    stages{
        stage('Checkout'){
            steps{
               checkout scmGit(branches: [[name: '*/master']], extensions: [], userRemoteConfigs: [[url: 'https://github.com/paycenonoli/ovia-addressbook.git']])
            }
        }
        stage('Maven build'){
            steps{
                sh "mvn package"
            }
        }
        stage('Docker build'){
            steps{
                sh "docker build -t 129431503188.dkr.ecr.us-east-2.amazonaws.com/ovia-private-repo:${BUILD_NUMBER} ."
            }
        }
        stage('ECR push'){
            steps{
                sh "aws ecr get-login-password --region us-east-2 | docker login --username AWS --password-stdin 129431503188.dkr.ecr.us-east-2.amazonaws.com"
                sh "docker push 129431503188.dkr.ecr.us-east-2.amazonaws.com/ovia-private-repo:${BUILD_NUMBER}"
            }
            
        }
        
    }
}